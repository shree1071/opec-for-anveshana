{"version":3,"file":"lib.umd.js","sources":["../src/version.ts","../src/index.ts"],"sourcesContent":["// This file is auto-generated during build\nexport const PACKAGE_VERSION = \"0.5.0\";\n","import { useEffect, useRef, useState } from \"react\";\nimport {\n  Conversation,\n  Mode,\n  SessionConfig,\n  Callbacks,\n  Options,\n  Status,\n  ClientToolsConfig,\n  InputConfig,\n  VadScoreEvent,\n} from \"@elevenlabs/client\";\n\nimport { PACKAGE_VERSION } from \"./version\";\n\nexport type Location = \"us\" | \"global\" | \"eu-residency\" | \"in-residency\";\n\nexport function parseLocation(location: string = \"us\"): Location {\n  switch (location) {\n    case \"eu-residency\":\n    case \"in-residency\":\n    case \"us\":\n    case \"global\":\n      return location;\n    default:\n      console.warn(\n        `[ConversationalAI] Invalid server-location: ${location}. Defaulting to \"us\"`\n      );\n      return \"us\";\n  }\n}\n\nexport function getOriginForLocation(location: Location): string {\n  const originMap: Record<Location, string> = {\n    us: \"wss://api.elevenlabs.io\",\n    \"eu-residency\": \"wss://api.eu.residency.elevenlabs.io\",\n    \"in-residency\": \"wss://api.in.residency.elevenlabs.io\",\n    global: \"wss://api.elevenlabs.io\",\n  };\n\n  return originMap[location];\n}\n\nexport type {\n  Role,\n  Mode,\n  Status,\n  SessionConfig,\n  DisconnectionDetails,\n  Language,\n  VadScoreEvent,\n} from \"@elevenlabs/client\";\nexport { postOverallFeedback } from \"@elevenlabs/client\";\n\nexport type HookOptions = Partial<\n  SessionConfig &\n    HookCallbacks &\n    ClientToolsConfig &\n    InputConfig & {\n      serverLocation?: Location | string;\n    }\n>;\nexport type ControlledState = {\n  micMuted?: boolean;\n  volume?: number;\n};\nexport type HookCallbacks = Pick<\n  Callbacks,\n  | \"onConnect\"\n  | \"onDisconnect\"\n  | \"onError\"\n  | \"onMessage\"\n  | \"onAudio\"\n  | \"onModeChange\"\n  | \"onStatusChange\"\n  | \"onCanSendFeedbackChange\"\n  | \"onDebug\"\n  | \"onUnhandledClientToolCall\"\n  | \"onVadScore\"\n>;\n\nexport function useConversation<T extends HookOptions & ControlledState>(\n  props: T = {} as T\n) {\n  const { micMuted, volume, serverLocation, ...defaultOptions } = props;\n  const conversationRef = useRef<Conversation | null>(null);\n  const lockRef = useRef<Promise<Conversation> | null>(null);\n  const [status, setStatus] = useState<Status>(\"disconnected\");\n  const [canSendFeedback, setCanSendFeedback] = useState(false);\n  const [mode, setMode] = useState<Mode>(\"listening\");\n\n  useEffect(() => {\n    if (micMuted !== undefined) {\n      conversationRef?.current?.setMicMuted(micMuted);\n    }\n  }, [micMuted]);\n\n  useEffect(() => {\n    if (volume !== undefined) {\n      conversationRef?.current?.setVolume({ volume });\n    }\n  }, [volume]);\n\n  useEffect(() => {\n    return () => {\n      conversationRef.current?.endSession();\n    };\n  }, []);\n\n  return {\n    startSession: (async (options?: HookOptions) => {\n      if (conversationRef.current?.isOpen()) {\n        return conversationRef.current.getId();\n      }\n\n      if (lockRef.current) {\n        const conversation = await lockRef.current;\n        return conversation.getId();\n      }\n\n      try {\n        const resolvedServerLocation = parseLocation(\n          options?.serverLocation || serverLocation\n        );\n        const origin = getOriginForLocation(resolvedServerLocation);\n\n        lockRef.current = Conversation.startSession({\n          ...(defaultOptions ?? {}),\n          ...(options ?? {}),\n          origin,\n          overrides: {\n            ...(defaultOptions?.overrides ?? {}),\n            ...(options?.overrides ?? {}),\n            client: {\n              ...(defaultOptions?.overrides?.client ?? {}),\n              ...(options?.overrides?.client ?? {}),\n              source:\n                options?.overrides?.client?.source ||\n                defaultOptions?.overrides?.client?.source ||\n                \"react_sdk\",\n              version:\n                options?.overrides?.client?.version ||\n                defaultOptions?.overrides?.client?.version ||\n                PACKAGE_VERSION,\n            },\n          },\n          // Pass through user-provided callbacks\n          onConnect: options?.onConnect || defaultOptions?.onConnect,\n          onDisconnect: options?.onDisconnect || defaultOptions?.onDisconnect,\n          onError: options?.onError || defaultOptions?.onError,\n          onMessage: options?.onMessage || defaultOptions?.onMessage,\n          onAudio: options?.onAudio || defaultOptions?.onAudio,\n          onDebug: options?.onDebug || defaultOptions?.onDebug,\n          onUnhandledClientToolCall:\n            options?.onUnhandledClientToolCall ||\n            defaultOptions?.onUnhandledClientToolCall,\n          onVadScore: options?.onVadScore || defaultOptions?.onVadScore,\n          onModeChange: ({ mode }) => {\n            setMode(mode);\n            (options?.onModeChange || defaultOptions?.onModeChange)?.({ mode });\n          },\n          onStatusChange: ({ status }) => {\n            setStatus(status);\n            (options?.onStatusChange || defaultOptions?.onStatusChange)?.({\n              status,\n            });\n          },\n          onCanSendFeedbackChange: ({ canSendFeedback }) => {\n            setCanSendFeedback(canSendFeedback);\n            (\n              options?.onCanSendFeedbackChange ||\n              defaultOptions?.onCanSendFeedbackChange\n            )?.({ canSendFeedback });\n          },\n        } as Options);\n\n        conversationRef.current = await lockRef.current;\n        // Persist controlled state between sessions\n        if (micMuted !== undefined) {\n          conversationRef.current.setMicMuted(micMuted);\n        }\n        if (volume !== undefined) {\n          conversationRef.current.setVolume({ volume });\n        }\n\n        return conversationRef.current.getId();\n      } finally {\n        lockRef.current = null;\n      }\n    }) as T extends SessionConfig\n      ? (options?: HookOptions) => Promise<string>\n      : (options: SessionConfig & HookOptions) => Promise<string>,\n    endSession: async () => {\n      const conversation = conversationRef.current;\n      conversationRef.current = null;\n      await conversation?.endSession();\n    },\n    setVolume: ({ volume }: { volume: number }) => {\n      conversationRef.current?.setVolume({ volume });\n    },\n    getInputByteFrequencyData: () => {\n      return conversationRef.current?.getInputByteFrequencyData();\n    },\n    getOutputByteFrequencyData: () => {\n      return conversationRef.current?.getOutputByteFrequencyData();\n    },\n    getInputVolume: () => {\n      return conversationRef.current?.getInputVolume() ?? 0;\n    },\n    getOutputVolume: () => {\n      return conversationRef.current?.getOutputVolume() ?? 0;\n    },\n    sendFeedback: (like: boolean) => {\n      conversationRef.current?.sendFeedback(like);\n    },\n    getId: () => {\n      return conversationRef.current?.getId();\n    },\n    sendContextualUpdate: (text: string) => {\n      conversationRef.current?.sendContextualUpdate(text);\n    },\n    sendUserMessage: (text: string) => {\n      conversationRef.current?.sendUserMessage(text);\n    },\n    sendUserActivity: () => {\n      conversationRef.current?.sendUserActivity();\n    },\n    sendMCPToolApprovalResult: (toolCallId: string, isApproved: boolean) => {\n      conversationRef.current?.sendMCPToolApprovalResult(\n        toolCallId,\n        isApproved\n      );\n    },\n    status,\n    canSendFeedback,\n    micMuted,\n    isSpeaking: mode === \"speaking\",\n  };\n}\n\n// const con = useConversation({agentId: \"\"})\n"],"names":["parseLocation","location","console","warn","getOriginForLocation","us","global","props","micMuted","volume","serverLocation","defaultOptions","_objectWithoutPropertiesLoose","_excluded","conversationRef","useRef","lockRef","_useState","useState","status","setStatus","_useState2","canSendFeedback","setCanSendFeedback","_useState3","mode","setMode","useEffect","_conversationRef$curr","undefined","current","setMicMuted","_conversationRef$curr2","setVolume","_conversationRef$curr3","endSession","startSession","options","_conversationRef$curr4","_exit","_temp2","_result","origin","Conversation","_extends","overrides","_defaultOptions$overr","_options$overrides","client","_defaultOptions$overr2","_defaultOptions$overr3","_options$overrides$cl","_options$overrides2","source","_options$overrides3","_defaultOptions$overr4","version","_options$overrides4","_defaultOptions$overr5","onConnect","onDisconnect","onError","onMessage","onAudio","onDebug","onUnhandledClientToolCall","onVadScore","onModeChange","_ref","_ref2","onStatusChange","_ref3","_ref4","onCanSendFeedbackChange","_ref5","_ref6","Promise","resolve","then","_lockRef$current","getId","_finallyRethrows","_wasThrown","_result2","isOpen","_temp","conversation","_conversation$getId","e","reject","_ref7","_conversationRef$curr5","getInputByteFrequencyData","_conversationRef$curr6","getOutputByteFrequencyData","_conversationRef$curr7","getInputVolume","_conversationRef$curr8","_conversationRef$curr9","getOutputVolume","_conversationRef$curr0","_conversationRef$curr1","sendFeedback","like","_conversationRef$curr10","_conversationRef$curr11","sendContextualUpdate","text","_conversationRef$curr12","sendUserMessage","_conversationRef$curr13","sendUserActivity","_conversationRef$curr14","sendMCPToolApprovalResult","toolCallId","isApproved","_conversationRef$curr15","isSpeaking"],"mappings":"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"}