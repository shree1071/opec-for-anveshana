{"version":3,"file":"lib.modern.js","sources":["../src/version.ts","../src/index.ts"],"sourcesContent":["// This file is auto-generated during build\nexport const PACKAGE_VERSION = \"0.5.0\";\n","import { useEffect, useRef, useState } from \"react\";\nimport {\n  Conversation,\n  Mode,\n  SessionConfig,\n  Callbacks,\n  Options,\n  Status,\n  ClientToolsConfig,\n  InputConfig,\n  VadScoreEvent,\n} from \"@elevenlabs/client\";\n\nimport { PACKAGE_VERSION } from \"./version\";\n\nexport type Location = \"us\" | \"global\" | \"eu-residency\" | \"in-residency\";\n\nexport function parseLocation(location: string = \"us\"): Location {\n  switch (location) {\n    case \"eu-residency\":\n    case \"in-residency\":\n    case \"us\":\n    case \"global\":\n      return location;\n    default:\n      console.warn(\n        `[ConversationalAI] Invalid server-location: ${location}. Defaulting to \"us\"`\n      );\n      return \"us\";\n  }\n}\n\nexport function getOriginForLocation(location: Location): string {\n  const originMap: Record<Location, string> = {\n    us: \"wss://api.elevenlabs.io\",\n    \"eu-residency\": \"wss://api.eu.residency.elevenlabs.io\",\n    \"in-residency\": \"wss://api.in.residency.elevenlabs.io\",\n    global: \"wss://api.elevenlabs.io\",\n  };\n\n  return originMap[location];\n}\n\nexport type {\n  Role,\n  Mode,\n  Status,\n  SessionConfig,\n  DisconnectionDetails,\n  Language,\n  VadScoreEvent,\n} from \"@elevenlabs/client\";\nexport { postOverallFeedback } from \"@elevenlabs/client\";\n\nexport type HookOptions = Partial<\n  SessionConfig &\n    HookCallbacks &\n    ClientToolsConfig &\n    InputConfig & {\n      serverLocation?: Location | string;\n    }\n>;\nexport type ControlledState = {\n  micMuted?: boolean;\n  volume?: number;\n};\nexport type HookCallbacks = Pick<\n  Callbacks,\n  | \"onConnect\"\n  | \"onDisconnect\"\n  | \"onError\"\n  | \"onMessage\"\n  | \"onAudio\"\n  | \"onModeChange\"\n  | \"onStatusChange\"\n  | \"onCanSendFeedbackChange\"\n  | \"onDebug\"\n  | \"onUnhandledClientToolCall\"\n  | \"onVadScore\"\n>;\n\nexport function useConversation<T extends HookOptions & ControlledState>(\n  props: T = {} as T\n) {\n  const { micMuted, volume, serverLocation, ...defaultOptions } = props;\n  const conversationRef = useRef<Conversation | null>(null);\n  const lockRef = useRef<Promise<Conversation> | null>(null);\n  const [status, setStatus] = useState<Status>(\"disconnected\");\n  const [canSendFeedback, setCanSendFeedback] = useState(false);\n  const [mode, setMode] = useState<Mode>(\"listening\");\n\n  useEffect(() => {\n    if (micMuted !== undefined) {\n      conversationRef?.current?.setMicMuted(micMuted);\n    }\n  }, [micMuted]);\n\n  useEffect(() => {\n    if (volume !== undefined) {\n      conversationRef?.current?.setVolume({ volume });\n    }\n  }, [volume]);\n\n  useEffect(() => {\n    return () => {\n      conversationRef.current?.endSession();\n    };\n  }, []);\n\n  return {\n    startSession: (async (options?: HookOptions) => {\n      if (conversationRef.current?.isOpen()) {\n        return conversationRef.current.getId();\n      }\n\n      if (lockRef.current) {\n        const conversation = await lockRef.current;\n        return conversation.getId();\n      }\n\n      try {\n        const resolvedServerLocation = parseLocation(\n          options?.serverLocation || serverLocation\n        );\n        const origin = getOriginForLocation(resolvedServerLocation);\n\n        lockRef.current = Conversation.startSession({\n          ...(defaultOptions ?? {}),\n          ...(options ?? {}),\n          origin,\n          overrides: {\n            ...(defaultOptions?.overrides ?? {}),\n            ...(options?.overrides ?? {}),\n            client: {\n              ...(defaultOptions?.overrides?.client ?? {}),\n              ...(options?.overrides?.client ?? {}),\n              source:\n                options?.overrides?.client?.source ||\n                defaultOptions?.overrides?.client?.source ||\n                \"react_sdk\",\n              version:\n                options?.overrides?.client?.version ||\n                defaultOptions?.overrides?.client?.version ||\n                PACKAGE_VERSION,\n            },\n          },\n          // Pass through user-provided callbacks\n          onConnect: options?.onConnect || defaultOptions?.onConnect,\n          onDisconnect: options?.onDisconnect || defaultOptions?.onDisconnect,\n          onError: options?.onError || defaultOptions?.onError,\n          onMessage: options?.onMessage || defaultOptions?.onMessage,\n          onAudio: options?.onAudio || defaultOptions?.onAudio,\n          onDebug: options?.onDebug || defaultOptions?.onDebug,\n          onUnhandledClientToolCall:\n            options?.onUnhandledClientToolCall ||\n            defaultOptions?.onUnhandledClientToolCall,\n          onVadScore: options?.onVadScore || defaultOptions?.onVadScore,\n          onModeChange: ({ mode }) => {\n            setMode(mode);\n            (options?.onModeChange || defaultOptions?.onModeChange)?.({ mode });\n          },\n          onStatusChange: ({ status }) => {\n            setStatus(status);\n            (options?.onStatusChange || defaultOptions?.onStatusChange)?.({\n              status,\n            });\n          },\n          onCanSendFeedbackChange: ({ canSendFeedback }) => {\n            setCanSendFeedback(canSendFeedback);\n            (\n              options?.onCanSendFeedbackChange ||\n              defaultOptions?.onCanSendFeedbackChange\n            )?.({ canSendFeedback });\n          },\n        } as Options);\n\n        conversationRef.current = await lockRef.current;\n        // Persist controlled state between sessions\n        if (micMuted !== undefined) {\n          conversationRef.current.setMicMuted(micMuted);\n        }\n        if (volume !== undefined) {\n          conversationRef.current.setVolume({ volume });\n        }\n\n        return conversationRef.current.getId();\n      } finally {\n        lockRef.current = null;\n      }\n    }) as T extends SessionConfig\n      ? (options?: HookOptions) => Promise<string>\n      : (options: SessionConfig & HookOptions) => Promise<string>,\n    endSession: async () => {\n      const conversation = conversationRef.current;\n      conversationRef.current = null;\n      await conversation?.endSession();\n    },\n    setVolume: ({ volume }: { volume: number }) => {\n      conversationRef.current?.setVolume({ volume });\n    },\n    getInputByteFrequencyData: () => {\n      return conversationRef.current?.getInputByteFrequencyData();\n    },\n    getOutputByteFrequencyData: () => {\n      return conversationRef.current?.getOutputByteFrequencyData();\n    },\n    getInputVolume: () => {\n      return conversationRef.current?.getInputVolume() ?? 0;\n    },\n    getOutputVolume: () => {\n      return conversationRef.current?.getOutputVolume() ?? 0;\n    },\n    sendFeedback: (like: boolean) => {\n      conversationRef.current?.sendFeedback(like);\n    },\n    getId: () => {\n      return conversationRef.current?.getId();\n    },\n    sendContextualUpdate: (text: string) => {\n      conversationRef.current?.sendContextualUpdate(text);\n    },\n    sendUserMessage: (text: string) => {\n      conversationRef.current?.sendUserMessage(text);\n    },\n    sendUserActivity: () => {\n      conversationRef.current?.sendUserActivity();\n    },\n    sendMCPToolApprovalResult: (toolCallId: string, isApproved: boolean) => {\n      conversationRef.current?.sendMCPToolApprovalResult(\n        toolCallId,\n        isApproved\n      );\n    },\n    status,\n    canSendFeedback,\n    micMuted,\n    isSpeaking: mode === \"speaking\",\n  };\n}\n\n// const con = useConversation({agentId: \"\"})\n"],"names":["_excluded","parseLocation","location","console","warn","getOriginForLocation","us","global","useConversation","props","micMuted","volume","serverLocation","defaultOptions","_objectWithoutPropertiesLoose","conversationRef","useRef","lockRef","status","setStatus","useState","canSendFeedback","setCanSendFeedback","mode","setMode","useEffect","_conversationRef$curr","undefined","current","setMicMuted","_conversationRef$curr2","setVolume","_conversationRef$curr3","endSession","startSession","async","_conversationRef$curr4","isOpen","getId","_defaultOptions$overr","_options$overrides","_defaultOptions$overr2","_defaultOptions$overr3","_options$overrides$cl","_options$overrides2","_options$overrides3","_defaultOptions$overr4","_options$overrides4","_defaultOptions$overr5","origin","options","Conversation","_extends","overrides","client","source","version","onConnect","onDisconnect","onError","onMessage","onAudio","onDebug","onUnhandledClientToolCall","onVadScore","onModeChange","_ref","onStatusChange","_ref2","onCanSendFeedbackChange","_ref3","conversation","_conversationRef$curr5","getInputByteFrequencyData","_conversationRef$curr6","getOutputByteFrequencyData","_conversationRef$curr7","getInputVolume","_conversationRef$curr8","_conversationRef$curr9","getOutputVolume","_conversationRef$curr0","_conversationRef$curr1","sendFeedback","like","_conversationRef$curr10","_conversationRef$curr11","sendContextualUpdate","text","_conversationRef$curr12","sendUserMessage","_conversationRef$curr13","sendUserActivity","_conversationRef$curr14","sendMCPToolApprovalResult","toolCallId","isApproved","_conversationRef$curr15","isSpeaking"],"mappings":"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"}